class Slider{constructor(t){if(this.slides=t.querySelector(".slides"),this.slide=t.querySelectorAll(".slide"),this.currentIndex=0,this.orientation=t.dataset.orientation||"horizontal",this.preventClick=!1,this.allowScroll=!1,this.startTouchTime=0,this.startX=0,this.startY=0,this.endX=0,this.scrollbar=t.querySelector(".scrollbar"),this.scrollbar&&(this.scrollbarThumb=this.scrollbar.querySelector(".scrollbar-thumb"),this.initScrollbar(),this.updateScrollbar()),"true"===t.dataset.thumbnailSlider){const i=t.dataset.thumbnailSliderId;this.thumbnailSlider=document.getElementById(i),this.thumbnailSlider&&(this.thumbnailSlides=this.thumbnailSlider.querySelectorAll(".slide"),this.initThumbnails())}this.autoplay="true"===t.dataset.autoplay,this.autoplayTime=parseInt(t.dataset.autoplayTime)||5e3,this.speed=parseInt(t.dataset.speed,10)||300,this.gap=parseInt(t.dataset.gap)||0,this.infinite="true"===t.dataset.infinite,this.autoplayInterval=null,this.autoplayTimeout=null,this.isAnimating=!1,this.isMouseDown=!1,this.isDragging=!1,this.paginationDots=[],this.navigation=t?.querySelector(".navigation"),this.isSliderEnabled=!0,this.showing=this.parseShowing(t.dataset.showing||"1|1|1|1"),this.slidesToShow=this.getSlidesToShow(),this.init()}parseShowing(t){return t.split("|").map(Number)}getSlidesToShow(){const t=window.innerWidth;return t>=1200?this.showing[0]:t>=900?this.showing[1]:t>=576?this.showing[2]:this.showing[3]}init(){this.showSlide(this.currentIndex),this.createPaginationDots(),this.addEventListeners(),this.updateSlidesWidth(),this.updateScrollbar(),this.updateThumbnailPosition(),this.updateNavVisibility(),this.autoplay&&this.startAutoplay(),window.addEventListener("resize",(()=>{const t=this.slidesToShow;this.slidesToShow=this.getSlidesToShow(),this.getSlidesToShow(),this.updateScrollbar(),this.updateSlidesWidth(),this.updatePaginationDots(),t!==this.slidesToShow&&this.updatePagination(),this.showSlide(this.currentIndex),this.updateThumbnailPosition(),this.updateNavVisibility()}))}disableSwipe(){this.isSliderEnabled=!1}enableSwipe(){this.isSliderEnabled=!0}toggleSwipe(t){this.isSliderEnabled=t}updateNavVisibility(){const t=this.slide.length,i=this.slides.parentElement.querySelector(".slider-prev"),s=this.slides.parentElement.querySelector(".slider-next"),e=this.slides.parentElement.querySelector(".pagination"),n=this.scrollbar,a=t>this.slidesToShow;i&&(i.style.display=a?"":"none",i.style.display=this.isSliderEnabled?"":"none"),s&&(s.style.display=a?"":"none",s.style.display=this.isSliderEnabled?"":"none"),e&&(e.style.display=a?"":"none",e.style.display=this.isSliderEnabled?"":"none",e.classList.toggle("hidden",!a)),n&&(n.style.display=a?"":"none",this.scrollbar.style.display=this.isSliderEnabled?"":"none"),this.isSwipeEnabled=t>this.slidesToShow,this.navigation&&(this.navigation.style.display=a?"":"none",this.navigation.style.display=this.isSwipeEnabled?"":"none",this.navigation.style.display=this.isSliderEnabled?"":"none",this.navigation.classList.toggle("hidden",!a))}initThumbnails(){this.thumbnailSlides.forEach(((t,i)=>{t.addEventListener("click",(()=>{this.showSlide(i)})),i===this.currentIndex&&t.classList.add("active")}))}updateThumbnailActiveState(){this.thumbnailSlides.forEach(((t,i)=>{t.classList.toggle("active",i===this.currentIndex)}))}moveThumbnailToStart(t){if(this.isAnimating)return;const i=this.thumbnailSlides.length-1,s="vertical"===this.thumbnailSlider.dataset.orientation;this.currentIndex=Math.max(0,Math.min(t,i)),this.isAnimating=!0,this.thumbnailSlides.forEach(((t,i)=>{t.classList.toggle("active",i===this.currentIndex)}));const e=this.thumbnailSlider.querySelector(".slides"),n=s?this.thumbnailSlides[0].clientHeight:this.thumbnailSlides[0].clientWidth,a=this.gap,h=this.getSlidesToShow(this.thumbnailSlider),l=this.thumbnailSlides.length;let o=this.currentIndex*(n+a);const d=(l-h)*(n+a);this.currentIndex>=l-h+1?o=d:this.currentIndex<h&&(o=0),e.style.transform=s?`translateY(-${o}px)`:`translateX(-${o}px)`,setTimeout((()=>{this.isAnimating=!1}),this.speed)}updateThumbnailPosition(){if(!this.thumbnailSlider)return;const t="vertical"===this.thumbnailSlider.dataset.orientation,i=this.thumbnailSlider.querySelector(".slides"),s=this.thumbnailSlides.length,e=t?this.thumbnailSlides[0].clientHeight:this.thumbnailSlides[0].clientWidth,n=parseInt(this.thumbnailSlider.dataset.gap,10),a=parseInt(this.thumbnailSlider.dataset.showing,10);let h=this.currentIndex*(e+n);const l=(s-a)*(e+n);this.currentIndex>s-a?h=l:this.currentIndex<0&&(h=0),i.style.transform=t?`translateY(-${Math.max(0,Math.min(h,l))}px)`:`translateX(-${Math.max(0,Math.min(h,l))}px)`}updateSlidesWidth(){const t=this.slide.length;if("horizontal"===this.orientation){const t=(this.slides.getBoundingClientRect().width-this.gap*(this.slidesToShow-1))/this.slidesToShow;this.slide.forEach((i=>{i.style.maxWidth=`${t}px`,i.style.height="auto",i.tabIndex="-1"}))}else{const t=(this.slides.getBoundingClientRect().height-this.gap*(this.slidesToShow-1))/this.slidesToShow;this.slide.forEach((i=>{i.style.maxWidth="100%",i.style.height=`${t}px`,i.tabIndex="-1"}))}this.slides.style.setProperty("--slides-to-show",`${this.getSlidesToShow()}`),this.slides.style.setProperty("--slides-total",`${t}`),this.gap?this.slides.style.setProperty("--slides-gap",`${this.gap}px`):this.slides.style.setProperty("--slides-gap","0px")}updatePagination(){const t=this.slides.parentElement.querySelector(".pagination");t&&(t.innerHTML="",this.paginationDots=[]),this.createPaginationDots(),this.updatePaginationDots()}createPaginationDots(){const t=this.slides.parentElement.querySelector(".pagination");if(t){t.innerHTML="",this.paginationDots=[];const i=this.slide.length,s=Math.max(1,i-this.slidesToShow+1);for(let i=0;i<s;i++){const s=document.createElement("div");s.classList.add("pagination-dot"),s.addEventListener("click",(()=>this.showSlide(i))),t.appendChild(s),this.paginationDots.push(s)}this.updatePaginationDots()}}updatePaginationDots(){if(this.paginationDots&&this.paginationDots.length>0){const t=Math.min(Math.floor(this.currentIndex),this.paginationDots.length-1);this.paginationDots.forEach(((i,s)=>{i.classList.toggle("active",s===t)}))}}initScrollbar(){this.updateScrollbar()}updateScrollbar(){if(!this.scrollbarThumb)return;const t=this.slide.length,i=this.slide[0].clientWidth,s=this.gap,e=t*i+(t-1)*s,n=this.slides.clientWidth;if(e<=n)return void(this.scrollbarThumb.style.width="0");const a=n/e*n;this.scrollbarThumb.style.width=`${a}px`;const h=this.currentIndex*(i+s)*(n/e),l=n-a;this.scrollbarThumb.style.transform=`translateX(${Math.max(0,Math.min(Math.ceil(h),Math.ceil(l)))}px)`}showSlide(t){if(this.isAnimating)return this.currentIndex;const i=this.slide.length,s=i-this.slidesToShow;if(this.infinite?this.currentIndex=t<0?i-this.slidesToShow:t>s?0:t:this.currentIndex=Math.max(0,Math.min(t,s)),this.isAnimating=!0,this.slides.style.transition=`transform ${this.speed}ms ease`,"horizontal"===this.orientation){const t=(this.slides.getBoundingClientRect().width-this.gap*(this.slidesToShow-1))/this.slidesToShow,i=this.currentIndex*t+this.currentIndex*this.gap;this.slides.style.transform=`translateX(-${i}px)`}else{const t=(this.slides.getBoundingClientRect().height-this.gap*(this.slidesToShow-1))/this.slidesToShow,i=this.currentIndex*t+this.currentIndex*this.gap;this.slides.style.transform=`translateY(-${i}px)`}return this.thumbnailSlides&&(this.updateThumbnailActiveState(),this.updateThumbnailPosition()),this.onSlideChange(Math.ceil(this.currentIndex)),this.updatePaginationDots(),this.updateNavigationButtons(),this.stopAutoplay(),this.updateScrollbar(),setTimeout((()=>{this.isAnimating=!1,this.updatePaginationDots(),this.resetAutoplay()}),this.speed),this.currentIndex}updateNavigationButtons(){const t=this.slides.parentElement.querySelector(".slider-prev"),i=this.slides.parentElement.querySelector(".slider-next"),s=this.slide.length-this.slidesToShow;if(t)if(t.setAttribute("aria-label","Предыдущий слайд"),t.setAttribute("role","button"),this.infinite)t.classList.remove("disabled"),t.setAttribute("aria-disabled",!1);else{const i=0===this.currentIndex;t.classList.toggle("disabled",i),t.setAttribute("aria-disabled",i),this.autoplay&&i&&(t.classList.remove("disabled"),t.setAttribute("aria-disabled",!1))}if(i)if(i.setAttribute("aria-label","Следующий слайд"),i.setAttribute("role","button"),this.infinite)i.classList.remove("disabled"),i.setAttribute("aria-disabled",!1);else{const t=this.currentIndex>=s;i.classList.toggle("disabled",t),i.setAttribute("aria-disabled",t),this.autoplay&&t&&(i.classList.remove("disabled"),i.setAttribute("aria-disabled",!1))}this.autoplay&&this.isAnimating&&setTimeout((()=>this.updateNavigationButtons()),this.speed)}getCurrentIndex(){return this.currentIndex}getSlideIndex(t){return Array.from(this.slide).indexOf(t)}getVisibleSlidesIndexes(){const t=[],i=this.slide.length;for(let s=0;s<this.slidesToShow;s++){const e=(this.currentIndex+s)%i;t.push(e)}return t}getSlideByIndex(t){return t>=0&&t<this.slide.length?this.slide[t]:null}onSlideChange(t){const i=new CustomEvent("slideChange",{detail:{index:t}});this.slides.dispatchEvent(i)}addEventListeners(){const t=t=>{this.stopAutoplay(),this.showSlide(this.currentIndex+t)};this.slides.addEventListener("click",(t=>{this.disableInteraction(t)})),this.slide.forEach((t=>{t.addEventListener("click",(t=>{(this.isDragging||this.preventClick)&&(t.preventDefault(),t.stopPropagation())}))})),this.slides.addEventListener("mousedown",(t=>{0===t.button&&(this.startSwipe(t),setTimeout((()=>{this.slides.classList.remove("isDragging")}),500),t.preventDefault(),document.addEventListener("mousemove",this.handleMouseMove),document.addEventListener("mouseup",this.handleMouseUp))})),this.slides.addEventListener("touchstart",(t=>{this.startSwipe(t),document.addEventListener("touchmove",this.handleTouchMove,{passive:!1}),document.addEventListener("touchend",this.handleTouchEnd)}));const i=this.slides.parentElement.querySelector(".slider-prev"),s=this.slides.parentElement.querySelector(".slider-next");i&&i.addEventListener("click",(()=>{this.stopAutoplay(),t(-1)})),s&&s.addEventListener("click",(()=>{this.stopAutoplay(),t(1)}))}startSwipe(t){this.isMouseDown=!0,this.allowScroll=!1,this.startTouchTime=Date.now(),"touchstart"===t.type?(this.startX=t.touches[0].clientX,this.startY=t.touches[0].clientY):(this.startX=t.clientX,this.startY=t.clientY),this.isDragging=!1,this.slides.style.transition="none"}disableInteraction(t){if(this.isDragging){if(t.preventDefault(),t.stopPropagation(),this.preventClick)return t.preventDefault(),t.stopImmediatePropagation(),!1;let i=t.target;for(;i&&i!==this.slides;){if("A"===i.tagName||"BUTTON"===i.tagName||i.onclick){i.style.pointerEvents="none",setTimeout((()=>{i.style.pointerEvents=""}),100);break}i=i.parentElement}}}handleMouseMove=t=>{this.isMouseDown&&this.isSwipeEnabled&&this.handleMove(t.clientX,t.clientY)};handleTouchMove=t=>{if(!this.isMouseDown||!this.isSwipeEnabled)return;const i=t.touches[0],s=Math.abs(i.clientX-this.startX),e=Math.abs(i.clientY-this.startY);if(e>s&&e>10)return this.allowScroll=!0,void this.resetDragState();s>10&&(t.preventDefault(),this.handleMove(i.clientX,i.clientY))};handleMove(t,i){this.isDragging=!0,this.slides.classList.add("isDragging");const s=t,e=i;if(this.distanceX=s-this.startX,this.distanceY=e-this.startY,"horizontal"===this.orientation){const t=(this.slides.getBoundingClientRect().width-this.gap*(this.slidesToShow-1))/this.slidesToShow,i=this.currentIndex*t+this.currentIndex*this.gap;if("true"===this.slides.parentElement.dataset.slideOnce){const i=.25*t;this.distanceX=Math.max(-i,Math.min(this.distanceX,i))}this.slides.style.transform=`translateX(-${i-this.distanceX}px)`}else{const t=(this.slides.getBoundingClientRect().height-this.gap*(this.slidesToShow-1))/this.slidesToShow,i=this.currentIndex*t+this.currentIndex*this.gap;if("true"===this.slides.parentElement.dataset.slideOnce){const i=.25*t;this.distanceY=Math.max(-i,Math.min(this.distanceY,i))}this.slides.style.transform=`translateY(-${i-this.distanceY}px)`}}handleMouseUp=t=>{this.isMouseDown&&this.isSwipeEnabled&&(this.isDragging&&(this.preventClick=!0,setTimeout((()=>{this.preventClick=!1}),100)),this.handleEnd(),document.removeEventListener("mousemove",this.handleMouseMove),document.removeEventListener("mouseup",this.handleMouseUp))};handleTouchEnd=t=>{this.allowScroll?this.allowScroll=!1:(this.handleEnd(),document.removeEventListener("touchend",this.handleTouchEnd))};handleEnd(){if(Date.now()-this.startTouchTime<300&&!this.isDragging)return void this.resetDragState();this.isMouseDown=!1,this.slides.style.transition=`transform ${this.speed}ms ease`;const t=Math.abs(this.distanceX)>10&&Math.abs(this.distanceX)>Math.abs(this.distanceY),i=Math.abs(this.distanceY)>10&&Math.abs(this.distanceY)>Math.abs(this.distanceX);if(!t&&!i)return void this.resetDragState();let s;if("vertical"===this.orientation){const t=(this.slides.getBoundingClientRect().height-this.gap*(this.slidesToShow-1))/this.slidesToShow;s=Math.abs(this.distanceY)<10?this.distanceY>0?1:-1:Math.round(this.distanceY/(t/2))}else{const t=(this.slides.getBoundingClientRect().width-this.gap*(this.slidesToShow-1))/this.slidesToShow;s=Math.abs(this.distanceX)<10?this.distanceX>0?1:-1:Math.round(this.distanceX/(t/2))}let e=this.currentIndex-s;const n=this.slide.length,a=n-this.slidesToShow;this.infinite?e<0?e=n-this.slidesToShow:e>a&&(e=0):e=Math.max(0,Math.min(e,a)),this.resetDragState(),this.slides.dispatchEvent(new CustomEvent("sliderMoveStart",{bubbles:!0,detail:{fromIndex:this.currentIndex,toIndex:e}})),this.showSlide(e),setTimeout((()=>{this.slides.dispatchEvent(new CustomEvent("sliderMoveEnd",{bubbles:!0,detail:{currentIndex:this.currentIndex}}))}),this.speed)}resetDragState(){this.isMouseDown=!1,this.isDragging=!1,this.distanceX=0,this.distanceY=0,this.slides.classList.remove("isDragging"),this.slides.style.transition=""}startAutoplay(){this.autoplayInterval=setInterval((()=>{this.showSlide(this.currentIndex+(this.slides.parentElement.dataset.slideOnce,1))}),this.speed+this.autoplayTime)}stopAutoplay(){clearInterval(this.autoplayInterval),clearTimeout(this.autoplayTimeout)}resetAutoplay(){clearTimeout(this.autoplayTimeout),this.autoplayTimeout=setTimeout((()=>{this.autoplay&&this.startAutoplay()}),this.autoplayTime)}}